var g=Object.defineProperty;var f=(h,t,s)=>t in h?g(h,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[t]=s;var e=(h,t,s)=>(f(h,typeof t!="symbol"?t+"":t,s),s);class w{constructor(){e(this,"button",null);e(this,"items",null);e(this,"mapWrapper",null);e(this,"shopsData",null);e(this,"shopList",null);e(this,"markCollection",null);e(this,"classes",{show:"show",hide:"hidden"});e(this,"map",!1);e(this,"mapAdd",!1);this.button=document.getElementById("change-display"),this.items=document.querySelectorAll("[data-shop-target]"),this.mapWrapper=document.getElementById("shops-map"),this.shopList=document.getElementById("shop_list"),this.shopsData=Array.from(document.querySelectorAll('input[name="shop_coord"]')).map(t=>({path:t.dataset.shopPath,coords:JSON.parse(t.value)})),this.button.addEventListener("click",this.toggle.bind(this)),this.addMap(this.shopsData)}addMarkCollection(t){this.markCollection=t}getMapCenter(){let t=0,s=0;for(var o=0;o<this.shopsData.length;o++)t+=this.shopsData[o].coords.lat,s+=this.shopsData[o].coords.long;return{lat:t/this.shopsData.length,long:s/this.shopsData.length}}scrollToShop(t){const o=document.getElementById(`anchor_${t}`).offsetTop-this.shopList.offsetTop;this.shopList.scrollTo({top:o,behavior:"smooth"})}addMap(t){if(this.mapAdd)return;const s=this.getMapCenter(),o=this.hideAllItems.bind(this),p=this.showShop.bind(this),m=this.scrollToShop.bind(this),c=this.items;ymaps.ready(function(){for(var d=new ymaps.Map("shops-map",{center:[s.lat,s.long],zoom:10},{searchControlProvider:"yandex#search"}),r=new ymaps.GeoObjectCollection(null,{iconColor:"#6c757d"}),i=0,u=t.length;i<u;i++){const l=new ymaps.Placemark([t[i].coords.lat,t[i].coords.long],{path:t[i].path});l.events.add("click",(n=>function(){o(),p(n),m(n.path),r.each(function(a){a.options.set("iconColor","#6c757d")}),l.options.set("iconColor","#1eafed")})(t[i])),r.add(l)}c.forEach(l=>l.addEventListener("click",n=>{c.forEach(a=>a.classList.remove("show")),r.each(function(a){a.options.set("iconColor","#6c757d"),n.target.dataset.shopTarget==a.properties.get("path")&&(n.target.classList.add("show"),d.setCenter(a.geometry.getCoordinates()),a.options.set("iconColor","#1eafed"))})})),d.geoObjects.add(r)}),this.mapAdd=!0}hideMap(){this.mapWrapper.classList.remove(this.classes.show)}showMap(){this.mapWrapper.classList.add(this.classes.show)}showShop(t){const s=document.querySelector(`[data-shop-target="${t.path}"]`);s.classList.remove(this.classes.hide),s.classList.add(this.classes.show)}hideAllItems(){this.button.textContent="Список",this.items.forEach(t=>t.classList.add(this.classes.hide)),this.items.forEach(t=>t.classList.remove(this.classes.show)),this.showMap(),this.map=!0}showAllItems(){this.button.textContent="Карта",this.items.forEach(t=>t.classList.add(this.classes.show)),this.items.forEach(t=>t.classList.remove(this.classes.hide)),this.hideMap(),this.map=!1}toggle(){return this.map?this.showAllItems():this.hideAllItems()}}document.addEventListener("DOMContentLoaded",()=>{new w});
